function Export2Doc(element,filename){var preHtml="<html xmlns:o='urn:schemas-microsoft-com:office:office' xmlns:w='urn:schemas-microsoft-com:office:word' xmlns='http://www.w3.org/TR/REC-html40'><head><meta charset='utf-8'><title>Export HTML To Doc</title></head><body>";var postHtml="</body></html>";var html=preHtml+document.getElementById(element).innerHTML+postHtml;var blob=new Blob(['ufeff',html],{type:'application/msword'});var url='data:application/vnd.ms-word;charset=utf-8,'+encodeURIComponent(html);filename=filename?filename+'.doc':'document.doc';var downloadLink=document.createElement("a");document.body.appendChild(downloadLink);if(navigator.msSaveOrOpenBlob){navigator.msSaveOrOpenBlob(blob,filename);}else{downloadLink.href=url;downloadLink.download=filename;downloadLink.click();} document.body.removeChild(downloadLink);} $.get('./fgdfgadjavdadasdasdasdbnvashdgasd.csv',function(data){processCsvData(data);},'text');var allData={};var typeOfReports=[];function processCsvData(data) {var rows=CSV.parse(data);for(var i=1;i<rows.length;i++) {var mainKey=rows[i][1];var subKey=rows[i][0];var value=rows[i][2];var valueVal=rows[i][3];var obj=allData[mainKey];if(obj===undefined) {var arr=[];if(valueVal.trim().length==0) {arr.push(value);} else {var keyValObj={};keyValObj[value]=valueVal;arr.push(keyValObj);} var newObj={};newObj[subKey]=arr;allData[mainKey]=newObj;} else {var newObj={};newObj[value]=valueVal;if(allData[mainKey][subKey]!=undefined) {allData[mainKey][subKey].push(valueVal.trim().length==0?value:newObj);} else {var arr=[];if(valueVal.trim().length==0) {arr.push(value);}else {arr.push(newObj);} allData[mainKey][subKey]=arr;}} var rowId=rows[i][0];switch(rowId){case"REPORT_TYPE":typeOfReports.push(rows[i]);}} console.log(allData);populateReportTypes();populateAllAutoSuggestionBoxes();} function populateReportTypes(){for(var i=0;i<typeOfReports.length;i++) {optionText=typeOfReports[i][2];optionValue=typeOfReports[i][1];$('#typeOfReport').append('<option value="'+optionValue+'"> '+optionText+'</option>');}} function populateReportData() {var key=$("#typeOfReport").val();var dataTypes={};dataTypes["OBSERVATION"]="observations";dataTypes["IMPRESSION"]="impressions";dataTypes["PROTOCOL"]="protocols";dataTypes["CONCLUSION"]="conclusions";dataTypes["SUGGESTION"]="suggestions";for(var property in dataTypes){populateCheckBoxes(key,property,dataTypes[property]);populateAllAutoSuggestionBoxes(key,property,dataTypes[property]);} $('#r_reportName').text(allData[key]["REPORT_TYPE"]);} function populateCheckBoxes(key,subKey,divId) {var checkBoxData="";if(allData[key]!=undefined) {var allObs=allData[key][subKey];if(allObs!=undefined) {for(var i=0;i<allObs.length;i++) {checkBoxData=checkBoxData+'<div class="form-group form-check"><label class="form-check-label"><input class="form-check-input" type="checkbox" name="'+subKey+'_ChkBox" value="'+allObs[i]+'">'+allObs[i]+'</label></div>';}}} $("#"+divId).html(checkBoxData);} function populateAllAutoSuggestionBoxes(key,subKey,entityType) {if(allData[key]!=undefined) {var allObs=allData[key]["SHORT_CUT_"+subKey];if(allObs!=undefined) {var newArr=[];for(var i=0;i<allObs.length;i++) {for(var property in allObs[i]){newArr.push(""+property+"@@@@"+allObs[i][property]);}} var newArr=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.whitespace,queryTokenizer:Bloodhound.tokenizers.whitespace,local:newArr});$('#autoCompleteBox_'+entityType).typeahead({hint:true,highlight:true,minLength:1},{name:'newArr',source:newArr});}}} function clearData(divId) {$("#"+divId).val('');} function generateReport() {var key=$("#typeOfReport").val();$('#r_reportName').text(allData[key]["REPORT_TYPE"]);var protocolPrefix="<strong>Protocol: </strong>";var protocol=getSelectedItems("PROTOCOL",false);$("#r_protocol").html(protocolPrefix+protocol);var observationPrefix="<br><strong>Observations: </strong><ul>";var observationPostfix="</ul>";var observation=getSelectedItems("OBSERVATION",true);if(observation.trim().length!=0) {$("#r_observations").html(observationPrefix+observation+observationPostfix);} var impresstionPrefix="<br><strong>Impression: </strong><ul>";var impresstionPostfix="</ul>";var impression=getSelectedItems("IMPRESSION",true);if(impression.trim().length!=0) {$("#r_impressions").html(impresstionPrefix+impression+impresstionPostfix);} var conclusionPrefix="<br><strong>Conclusion: </strong><ul>";var conclusionPostfix="</ul>";var conclusion=getSelectedItems("CONCLUSION",false);if(conclusion.trim().length!=0) {$("#r_conclusion").html(conclusionPrefix+conclusion+conclusionPostfix);} var suggestion=getSelectedItems("SUGGESTION",false);if(suggestion.trim().length!=0) {$("#r_suggestions").html("<br>"+suggestion);} $("#r_signature").html("<br>Dr. Gokul Kathade, <br>Consultant Radiologist,<br>M.D. Radiology (Sion, Mumbai),<br>dr.gokul.kathade@gmail.com");} function getSelectedItems(entityType,liNeeded) {var text="";var selectedProtocolArr=[];$("input:checkbox[name="+entityType+"_ChkBox]:checked").each(function(){selectedProtocolArr.push($(this).val());});for(var i=0;i<selectedProtocolArr.length;i++) {var value=selectedProtocolArr[i] if(liNeeded) {value="<li>"+value+"</li>";} else {value=value+"<br>";} text=text+value;} return text;} function addTypedOptions(entityType,subKey) {var value=$("#autoCompleteBox_"+entityType).val();if(value.trim().length!=0) {if(value.indexOf("@@@@")!=-1) {value=value.split("@@@@")[1];} var selectedArr=[];$("input:checkbox[name="+subKey+"_ChkBox]:checked").each(function(){selectedArr.push($(this).val());});var html=$("#"+entityType).html();html=html+'<div class="form-group form-check"><label class="form-check-label"><input class="form-check-input" type="checkbox" name="'+subKey+'_ChkBox" value="'+value+'" checked>'+value+'</label></div>';$("#"+entityType).html(html);for(var i=0;i<selectedArr.length;i++) {$("input:checkbox[value='"+selectedArr[i]+"']").prop("checked",true);}}} function exportWord() {Export2Doc('exportContent',getReportName());} function exportPDF() {var ptName=$("#patientName").val();var d=new Date();var formattedOne=d.getDate()+"/"+(d.getMonth()+1)+"/"+d.getFullYear();var additionalDiv="<div style='text-align: left'><span><strong>Name Of Patient: </strong>"+ptName+"</span></div><div style='text-align: right;'><span><strong>Date: </strong>"+formattedOne+"</span></div><br>" $("#r_ptName").html(additionalDiv);var divContents=$("#exportContent").html();var printWindow=window.open('','','height=400,width=800');printWindow.document.write('<html><head><title>'+getReportName()+'</title>');printWindow.document.write('</head><body>');printWindow.document.write(divContents);printWindow.document.write('</body></html>');printWindow.document.close();printWindow.print();} function getReportName() {var patientName=$("#patientName").val();var d=new Date();var formattedOne=d.getDate()+"_"+(d.getMonth()+1)+"_"+d.getFullYear();var typeOfReport=$("#typeOfReport").val();if(patientName.trim().length!=0) {patientName=patientName.split(" ").join("_")+"_";} return patientName+formattedOne+"_"+typeOfReport;}
